<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Splat Plate â€” Viewer</title>

  <!-- PlayCanvas web components -->
  <script type="importmap">
  { "imports": { "playcanvas": "https://cdn.jsdelivr.net/npm/playcanvas@latest/build/playcanvas.mjs" } }
  </script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@playcanvas/web-components@latest/dist/pwc.mjs"></script>

  <style>
    html, body { margin:0; height:100%; overflow:hidden; background:#0b0b0b; }
    * { box-sizing: border-box; }
    .wrap { position:fixed; inset:0; }
    pc-app { position:absolute; inset:0; display:block; touch-action:none; user-select:none; }
  </style>
</head>
<body>
  <div class="wrap">
    <pc-app antialias="false" high-resolution="false" alpha="false" depth="false" stencil="false">
      <!-- Assets -->
      <pc-asset id="plate" src="./export_ply.sog"></pc-asset>
      <pc-asset id="cameraControls"
        src="https://cdn.jsdelivr.net/npm/playcanvas@latest/scripts/esm/camera-controls.mjs"></pc-asset>

      <!-- Scene -->
      <pc-scene>
        <!-- Camera Rig -->
        <pc-entity id="camRig" position="0 0 0" rotation="-28 16 0">
          <pc-entity id="camera" position="0 0 2.3">
            <pc-camera clear-color="#0b0b0b" fov="40"></pc-camera>
            <pc-scripts>
              <pc-script name="cameraControls" attributes='{
                "enableFly": false,
                "enablePan": false,
                "focusPoint": "vec3:0,0,0",
                "pitchRange": "vec2:-80,-10",
                "sceneSize": 3,
                "zoomRange": "vec2:1.6,3.2"
              }'></pc-script>
            </pc-scripts>
          </pc-entity>
        </pc-entity>

        <!-- Plate -->
        <pc-entity id="splat" position="0 0 0" rotation="180 0 0" scale="2.8 2.8 2.8">
          <pc-splat asset="plate"></pc-splat>

          <!-- Add autorotation -->
          <pc-scripts>
            <pc-script name="autoRotate" attributes='{
              "speed": 10
            }'></pc-script>
          </pc-scripts>
        </pc-entity>
      </pc-scene>
    </pc-app>
  </div>

  <!-- Autorotate script -->
  <script type="module">
    const appEl = document.querySelector('pc-app');

    const SPEED_DEG_PER_SEC = 10;

    function start() {
      const app = appEl.app;
      if (!app) { requestAnimationFrame(start); return; }

      const splat = app.root.findByName('splat');
      if (!splat) { requestAnimationFrame(start); return; }

      app.on('update', (dt) => {
        const e = splat.getLocalEulerAngles();
        e.y += SPEED_DEG_PER_SEC * dt;
        splat.setLocalEulerAngles(e);
      });
    }

    if (appEl.app) start();
    else appEl.addEventListener('initialized', start, { once: true });
  </script>
</body>
</html>
